{% extends 'base.html' %}

{% load app_extras %}

{% block body %}

<center>
    <h1>
        {{ text.title }}
    </h1>
    {% if br %}
        <small style="font-size: 0.8em;">{{ count }} - Words Reamined</small>
    {% endif %}
    <hr>
</center>
<br><br><br>

<p style="line-height: 70px;">
    {% for word in content %}
        <span onclick="clicktotranslate(this)" class="on_hover_text_decoration_underline">{{ word|safe }}</span>

        {% if br %}
            <input type="checkbox"
                {{ word|doiknow:text.id }}
                style="width: 25px; height: 25px; position: relative; top: 7px;"
                onchange="idonotknow_checkbox(this)" word='"{{ word }}"'>
            <br><br>
        {% endif %}
    {% endfor %}

    <center>
        <hr><br>
        <a href="/translate/{{ text.id }}/s/{{ page }}">
            <b style="text-decoration: underline;">
                -{{ page }}-
            </b>
        </a>
        <br><br><hr>
    </center>
</p>

<div id="translated" style="
    border: 1px solid gray;
    padding: 1%; margin-top: 1%;
    text-align: center;

    background-color: antiquewhite;

    position: fixed;
    top: 750px;
    left: 750px;
    ">
X</div>

<script>
    function clicktotranslate(e) {
        var translated = document.getElementById('translated');
        word = e.innerHTML;
        $.ajax({
            url: '/translate',
            type: 'POST',
            data: {
                word: word
            },
            success: function(data) {
                console.log(data);
                translated.innerHTML = `<b style="text-decoration: underline; cursor: pointer;"><span onclick="idonotknow(` +data.id+ `)">` +data.word+ `</span></b>`;
                    }
            });
        }

    function idonotknow(word_id) {
        $.ajax({
            url: '/i-do-not-know',
            type: 'POST',
            data: {
                text_id: {{ text.id }},
                word_id: word_id
            },
            success: function(data) { }
            });
        }
    
    function idonotknow_checkbox(e) {
        word = e.getAttribute("word");
        operation = ""
        
        if (e.checked == true) {
            operation = "add";
        }
        if (e.checked == false) {
            operation = "remove";
        }

        $.ajax({
            url: '/i-do-not-know-checkbox',
            type: 'POST',
            data: {
                operation: operation,
                text_id: {{ text.id }},
                word: word
            },
            success: function(data) { }
            });
        }
</script>

{% endblock %}